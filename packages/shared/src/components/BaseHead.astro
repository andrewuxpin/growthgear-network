---
import type { SEOData } from "../types";

interface Props {
  seo: SEOData;
  siteUrl: string;
  siteName: string;
  theme?: "ai" | "sales" | "marketing" | "hub";
  gaId?: string;
}

const { seo, siteUrl, siteName, theme = "ai", gaId } = Astro.props;
const canonicalUrl = seo.canonical || new URL(Astro.url.pathname, siteUrl).href;
const imageUrl = seo.image ? new URL(seo.image, siteUrl).href : undefined;
---

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="generator" content={Astro.generator} />

  <!-- Primary Meta Tags -->
  <title>{seo.title}</title>
  <meta name="title" content={seo.title} />
  <meta name="description" content={seo.description} />
  <link rel="canonical" href={canonicalUrl} />

  {seo.noindex && <meta name="robots" content="noindex, nofollow" />}

  <!-- Open Graph / Facebook -->
  <meta property="og:type" content={seo.type || "website"} />
  <meta property="og:url" content={canonicalUrl} />
  <meta property="og:title" content={seo.title} />
  <meta property="og:description" content={seo.description} />
  <meta property="og:site_name" content={siteName} />
  {imageUrl && <meta property="og:image" content={imageUrl} />}
  {seo.publishedTime && <meta property="article:published_time" content={seo.publishedTime} />}
  {seo.modifiedTime && <meta property="article:modified_time" content={seo.modifiedTime} />}
  {seo.author && <meta property="article:author" content={seo.author} />}
  {seo.tags?.map((tag) => <meta property="article:tag" content={tag} />)}

  <!-- Twitter -->
  <meta name="twitter:card" content={imageUrl ? "summary_large_image" : "summary"} />
  <meta name="twitter:url" content={canonicalUrl} />
  <meta name="twitter:title" content={seo.title} />
  <meta name="twitter:description" content={seo.description} />
  {imageUrl && <meta name="twitter:image" content={imageUrl} />}

  <!-- Fonts - Optimized loading -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    rel="preload"
    as="style"
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
  />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
    rel="stylesheet"
    media="print"
    onload="this.media='all'"
  />
  <noscript>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
  </noscript>

  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />

  <!-- Theme -->
  <script is:inline define:vars={{ theme }}>
    document.documentElement.setAttribute("data-theme", theme);
  </script>

  <!-- Google Analytics -->
  {
    gaId && (
      <>
        <script async src={`https://www.googletagmanager.com/gtag/js?id=${gaId}`} />
        <script is:inline define:vars={{ gaId }}>
          window.dataLayer = window.dataLayer || [];
          function gtag() {
            dataLayer.push(arguments);
          }
          gtag("js", new Date());
          gtag("config", gaId);
        </script>
      </>
    )
  }

  <slot />
</head>
